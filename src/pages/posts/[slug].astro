---
export const prerender = false;

import { getPost, getPosts } from "@/libs/api/post";
import BaseLayout from "../../layouts/BaseLayout.astro";
const { slug } = Astro.params;

const post = await getPost(slug);
const { date_gmt, title, _embedded } = post;

const date = new Date(date_gmt).toLocaleDateString("en-US", {
	year: "numeric",
	month: "long",
	day: "numeric",
});

export async function getStaticPaths() {
	const posts = await getPosts();

	const transformedPosts = posts.map((post) => {
		return {
			params: {
				slug: post.slug,
			},
		};
	});

	return transformedPosts;
}
---

<BaseLayout title={title.rendered}>
	<div>
		<header
			class="mx-auto flex max-w-7xl flex-col items-center justify-center space-y-3 border-b-2 border-b-yellow-500 px-5 py-10"
		>
			<div class="w-fit rounded-full bg-yellow-300 px-2 py-0.5 text-sm text-gray-700">
				{_embedded["wp:term"][0][0].name}
			</div>
			<h1 transition:name={slug} class="text-center font-kanit text-3xl font-medium">
				{post.title.rendered}
			</h1>
			<time class="text-center font-kanit text-gray-500" datetime={date_gmt}>{date}</time>
		</header>
		<article class="mx-auto mt-5 max-w-7xl px-5 pb-20">
			<Fragment set:html={post.content.rendered} />
		</article>
	</div>
</BaseLayout>
